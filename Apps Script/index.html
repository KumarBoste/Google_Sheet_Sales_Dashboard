<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <title>Dashboard</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/apexcharts/3.35.0/apexcharts.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Arial', sans-serif;
    }
    
    body {
      background-color: #f5f7fa;
      padding: 30px;
    }
    
    .dashboard-container {
      max-width: 1920px;
      margin: 0 auto;
      padding: 30px;
      
      border-radius: 10px;
      
    }
    
    /* Main Heading */
    .main-heading {
      margin-bottom: 30px;
      margin-top: -40px;
      color: #021640;
    }
    
    .main-heading h1 {
      font-size: 28px;
      margin-bottom: 5px;
    }
    
    .main-heading h2 {
      font-size: 18px;
      font-weight: normal;
      opacity: 0.8;
    }
    
    /* Metric Cards */
    .metric-cards {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 24px;
      margin-bottom: 30px;
    }
    
    .metric-card {
      background-color: white;
      border-radius: 8px;
      padding: 20px;
      height: 100px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      position: relative;
      border-left: 4px solid #021640;
    }
    
    .metric-card h3 {
      font-size: 14px;
      color: #021640;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
    }
    
    .metric-card i {
      margin-right: 8px;
      color: #021640;
    }
    
    .metric-card h2 {
      font-size: 24px;
      color: #021640;
      font-weight: bold;
    }
    
    /* Chart Grid */
    .chart-grid {
      display: grid;
      grid-template-columns: 650px 300px minmax(0, 1fr);
      gap: 24px;
    }
    
    .chart-column {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }
    
    .chart-card {
      background-color: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }
    
    .chart-card h3 {
      font-size: 16px;
      color: #021640;
      margin-bottom: 20px;
    }
    
    .chart-row {
      display: flex;
      gap: 24px;
    }
    
    .chart-50 {
      flex: 1;
      width: 50%;
    }
    
    .chart-25 {
      flex: 1;
      width: 50%;
    }
    
    .chart-75 {
      flex: 1;
      width: 50%;
    }
    
    /* Loading State */
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-size: 24px;
      color: #021640;
    }
    
    .loading i {
      margin-right: 10px;
      animation: spin 1s infinite linear;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="loading" class="loading">
    <i class="fas fa-spinner"></i> Loading dashboard data...
  </div>
  
  <div id="dashboard" class="dashboard-container" style="display: none;">
    <!-- Main Heading -->
    <div class="main-heading">
      <h1>Dashboard</h1>
      <h2>Key trends and business insights</h2>
    </div>
    
    <!-- Metric Cards -->
    <div class="metric-cards">
      <div class="metric-card">
        <h3><i class="fas fa-chart-line"></i> Total Sales</h3>
        <h2 id="totalSales">$0</h2>
      </div>
      <div class="metric-card">
        <h3><i class="fas fa-money-bill"></i> Total Cost</h3>
        <h2 id="totalCost">$0</h2>
      </div>
      <div class="metric-card">
        <h3><i class="fas fa-percentage"></i> Average Margin</h3>
        <h2 id="avgMargin">0%</h2>
      </div>
      <div class="metric-card">
        <h3><i class="fas fa-map-marker-alt"></i> Top Sales Location</h3>
        <h2 id="topLocation">-</h2>
      </div>
      <div class="metric-card">
        <h3><i class="fas fa-box"></i> Top Selling Product</h3>
        <h2 id="topProduct">-</h2>
      </div>
      <div class="metric-card">
        <h3><i class="fas fa-user"></i> Top Customer</h3>
        <h2 id="topCustomer">-</h2>
      </div>
    </div>
    
    <!-- Chart Grid -->
    <div class="chart-grid">
      <!-- First Column -->
      <div class="chart-column">
        <div class="chart-card">
          <h3>Sales Trend</h3>
          <div id="salesTrendChart"></div>
        </div>
        <div class="chart-row">
          <div class="chart-card chart-50">
            <h3>Sales By Location</h3>
            <div id="salesByLocationChart"></div>
          </div>
          <div class="chart-card chart-50">
            <h3>Sales By Category</h3>
            <div id="salesByCategoryChart"></div>
          </div>
        </div>
      </div>
      
      <!-- Second Column -->
      <div class="chart-column">
        <div class="chart-card">
          <h3>Top 10 Customers</h3>
          <div id="topCustomersChart"></div>
        </div>
      </div>
      
      <!-- Third Column -->
      <div class="chart-column">
        <div class="chart-row">
          <div class="chart-card chart-50">
             <h3>Profit By Location</h3>
            <div id="profitByLocationChart"></div>
          </div>
          <div class="chart-card chart-50">
            <h3>Profit By Category</h3>
            <div id="profitByCategoryChart"></div>
          </div>
        </div>
        <div class="chart-row">
          <div class="chart-card chart-25">
            <h3>Sales, Expense and Profit</h3>
            <div id="salesExpenseProfitChart"></div>
          </div>           


          <div class="chart-card chart-75">
            <h3>Sales and Profit Trend</h3>
            <div id="salesProfitTrendChart"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // Initialize dashboard after data loads
    document.addEventListener('DOMContentLoaded', function() {
      google.script.run
        .withSuccessHandler(initDashboard)
        .withFailureHandler(handleError)
        .getDashboardData();
    });
    
    function handleError(error) {
      document.getElementById('loading').innerHTML = '<i class="fas fa-exclamation-triangle"></i> Error loading data: ' + error;
    }
    
    function initDashboard(data) {
      // Hide loading, show dashboard
      document.getElementById('loading').style.display = 'none';
      document.getElementById('dashboard').style.display = 'block';
      
      // Set metric card values
      document.getElementById('totalSales').textContent = formatCurrency(data.totalSales);
      document.getElementById('totalCost').textContent = formatCurrency(data.totalCost);
      document.getElementById('avgMargin').textContent = formatPercentage(data.avgMargin);
      document.getElementById('topLocation').textContent = data.topLocation;
      document.getElementById('topProduct').textContent = data.topProduct;
      document.getElementById('topCustomer').textContent = data.topCustomer;
      
      // Initialize charts
      initSalesTrendChart(data.salesTrend);
      initSalesByLocationChart(data.salesByLocation);
      initSalesByCategoryChart(data.salesByCategory);
      initTopCustomersChart(data.topCustomers);
      initSalesExpenseProfitChart(data.salesExpenseProfit);
      initProfitByCategoryChart(data.profitByCategory);
      initProfitByLocationChart(data.profitByLocation);
      initSalesProfitTrendChart(data.salesProfitTrend);
    }
    
    function formatCurrency(value) {
      return '$' + parseFloat(value).toLocaleString('en-US', {
        minimumFractionDigits: 0,
        maximumFractionDigits: 0
      });
    }
    
    function formatPercentage(value) {
      return parseFloat(value).toFixed(2) + '%';
    }
    
    // Chart 1: Sales Trend
    function initSalesTrendChart(data) {
      const options = {
        series: [{
          name: 'Sales',
          data: data.values
        }],
        chart: {
          type: 'area',
          height: 300,
          fontFamily: 'Arial, sans-serif',
          toolbar: {
            show: false
          }
        },


        markers: {
    size: 2,
    colors: '#021640',
    strokeColors: '#021640',
    strokeWidth: 2,
    
},
        dataLabels: {
          enabled: false
        },
        stroke: {
          curve: 'smooth',
          width: 2,
          colors: ['#021640']
        },
        fill: {
          type: 'gradient',
          gradient: {
            shade: 'light',
            type: 'vertical',
            shadeIntensity: 0.8,
            opacityFrom: 0.7,
            opacityTo: 0.2,
            stops: [0, 100]
          },
          colors: ['#021640']
        },
xaxis: {
  type: 'datetime', // treat categories as dates
  categories: data.dates, // ensure these are valid date strings or timestamps
  labels: {
    format: 'MMM-yy', // display dates in "MMM-YY" format
    style: {
      colors: '#021640',
      fontSize: '12px'
    }
  }
},
        yaxis: {
          labels: {
            formatter: function(value) {
              return (value / 1000) + 'k';
            },
            style: {
              colors: '#021640',
              fontSize: '12px'
            }
          }
        },
        tooltip: {
          x: {
            format: 'MMM yyyy'
          }
        },
        colors: ['#021640'],
        grid: {
          borderColor: '#e0e0e0',
          strokeDashArray: 4
        }
      };
      
      const chart = new ApexCharts(document.querySelector("#salesTrendChart"), options);
      chart.render();
    }
    
    // Chart 2: Sales By Location
    function initSalesByLocationChart(data) {
      const options = {
        series: [{
          name: 'Sales',
          data: data.values
        }],
        chart: {
          type: 'bar',
          height: 300,
          fontFamily: 'Arial, sans-serif',
          toolbar: {
            show: false
          }
        },
        plotOptions: {
          bar: {
            borderRadius: 4,
            horizontal: false,
            columnWidth: '80%'
          }
        },
        dataLabels: {
          enabled: false
        },
        xaxis: {
          categories: data.locations,
          labels: {
            style: {
              colors: '#021640',
              fontSize: '12px'
            }
          }
        },
        yaxis: {
          labels: {
            formatter: function(value) {
              return (value / 1000) + 'k';
            },
            style: {
              colors: '#021640',
              fontSize: '12px'
            }
          }
        },
        colors: ['#0066CC',],
        grid: {
          borderColor: '#e0e0e0',
          strokeDashArray: 4
        }
      };
      
      const chart = new ApexCharts(document.querySelector("#salesByLocationChart"), options);
      chart.render();
    }
    
    // Chart 3: Sales By Category
    function initSalesByCategoryChart(data) {
      const options = {
        series: data.values,
        chart: {
          type: 'pie',
          height: 300,
          fontFamily: 'Arial, sans-serif',
          toolbar: {
            show: false
          }
        },
        labels: data.categories,
        colors: ['#021640', '#0066CC', '#0099CC' ],
        legend: {
          position: 'bottom',
          fontSize: '12px',
          fontFamily: 'Arial, sans-serif',
          labels: {
            colors: '#021640'
          }
        },
        dataLabels: {
          enabled: true,
          formatter: function(val) {
            return val.toFixed(1) + '%';
          },
          style: {
            fontSize: '12px',
            fontFamily: 'Arial, sans-serif',
            fontWeight: 'normal',
            colors: ['#fff']
          }
        },
        tooltip: {
          y: {
            formatter: function(value) {
              return formatCurrency(value);
            }
          }
        },
        responsive: [{
          breakpoint: 480,
          options: {
            chart: {
              height: 300
            },
            legend: {
              position: 'bottom'
            }
          }
        }]
      };
      
      const chart = new ApexCharts(document.querySelector("#salesByCategoryChart"), options);
      chart.render();
    }
    
    // Chart 4: Top 10 Customers
    function initTopCustomersChart(data) {
      data.values.reverse();
      data.customers.reverse();
      const options = {
        series: [{
          name: 'Sales',
          data: data.values
        }],
        chart: {
          type: 'bar',
          height: 720,
          fontFamily: 'Arial, sans-serif',
          toolbar: {
            show: false
          }
        },
        plotOptions: {
          bar: {
            borderRadius: 4,
            horizontal: true
          }
        },
        dataLabels: {
          enabled: true
        },
        xaxis: {
          categories: data.customers,
          labels: {
            formatter: function(value) {
              return (value / 1000) + 'k';
            },
            style: {
              colors: '#021640',
              fontSize: '12px'
            }
          }
        },
        yaxis: {
          labels: {
            style: {
              colors: '#021640',
              fontSize: '12px'
            }
          }
        },
        colors: ['#0066CC'],
        grid: {
          borderColor: '#e0e0e0',
          strokeDashArray: 4
        }
      };
      
      const chart = new ApexCharts(document.querySelector("#topCustomersChart"), options);
      chart.render();
    }
    
    // Chart 5: Sales, Expense and Profit
    function initSalesExpenseProfitChart(data) {
      const options = {
        series: [{
          name: 'Sales',
          data: data.sales
        }, {
          name: 'Cost',
          data: data.costs
        }, {
          name: 'Expenses',
          data: data.expenses
        }, {
          name: 'Profit',
          data: data.profits
        }],
        chart: {
          type: 'bar',
          height: 300,
          stacked: true,
          stackType: '100%',
          fontFamily: 'Arial, sans-serif',
          toolbar: {
            show: false
          }
        },
        plotOptions: {
          bar: {
            horizontal: true
          }
        },
        stroke: {
          width: 1,
          colors: ['#fff']
        },
        xaxis: {
          categories: data.years,
          labels: {
            style: {
              colors: '#021640',
              fontSize: '12px'
            }
          }
        },
        yaxis: {
          labels: {
            style: {
              colors: '#021640',
              fontSize: '12px'
            }
          }
        },
        tooltip: {
          y: {
            formatter: function (val) {
              return val + "%";
            }
          }
        },
        fill: {
          opacity: 1
        },
        legend: {
          position: 'bottom',
          horizontalAlign: 'center',
          fontSize: '12px',
          labels: {
            colors: '#021640'
          }
        },
        colors: ['#021640', '#0066CC', '#0099CC', '#4572C4'],
        dataLabels: {
          enabled: false
        }
      };
      
      const chart = new ApexCharts(document.querySelector("#salesExpenseProfitChart"), options);
      chart.render();
    }
    
    // Chart 6: Profit By Category
    function initProfitByCategoryChart(data) {
      const options = {
        series: data.series,
        chart: {
          type: 'bar',
          height: 300,
          stacked: true,
          fontFamily: 'Arial, sans-serif',
          toolbar: {
            show: false
          }
        },
        plotOptions: {
          bar: {
            borderRadius: 4,
            horizontal: false,
            columnWidth: '55%'
          }
        },
        dataLabels: {
          enabled: true
        },
        xaxis: {
          categories: data.years,
          labels: {
            style: {
              colors: '#021640',
              fontSize: '12px'
            }
          }
        },
        yaxis: {
          labels: {
            formatter: function(value) {
              return (value / 1000) + 'k';
            },
            style: {
              colors: '#021640',
              fontSize: '12px'
            }
          }
        },
        legend: {
          position: 'bottom',
          horizontalAlign: 'center',
          fontSize: '12px',
          labels: {
            colors: '#021640'
          }
        },
        fill: {
          opacity: 1
        },
        colors: ['#021640', '#0066CC', '#0099CC', '#4572C4', '#558ED5', '#1F4E79'],
        grid: {
          borderColor: '#e0e0e0',
          strokeDashArray: 4
        }
      };
      
      const chart = new ApexCharts(document.querySelector("#profitByCategoryChart"), options);
      chart.render();
    }
    
 // Chart 7: Profit By Location
function initProfitByLocationChart(data) {
  const options = {
    series: data.values,
    chart: {
      type: 'donut',
      height: 300,
      fontFamily: 'Arial, sans-serif'
    },
    labels: data.locations,
    colors: ['#021640', '#0066CC', '#0099CC', '#4572C4', '#558ED5', '#1F4E79'],
    legend: {
      show: true,
      position: 'bottom'
    },
    plotOptions: {
      pie: {
        // This formatter displays the location name and percentage inside each slice.
        dataLabels: {
          offset: 0,
          formatter: function (val, opts) {
            return opts.w.globals.labels[opts.seriesIndex] + ": " + Math.round(val) + "%";
          }
        },
        donut: {
          size: '50%',
          labels: {
            show: true,
            name: {
              show: true,
              fontSize: '10px',
              fontFamily: 'Arial, sans-serif',
              color: '#021640'
            },
            value: {
              show: true,
              fontSize: '16px',
              fontFamily: 'Arial, sans-serif',
              color: '#021640',
              formatter: function (val) {
                return val + "%";
              }
            },
            total: {
              show: true,
              label: 'Total',
              fontSize: '14px',
              color: '#021640',
              formatter: function () {
                return '100%';
              }
            }
          }
        }
      }
    },
    responsive: [{
      breakpoint: 480,
      options: {
        chart: {
          height: 250
        }
      }
    }]
  };
  
  const chart = new ApexCharts(document.querySelector("#profitByLocationChart"), options);
  chart.render();
}


// Chart 8: Sales and Profit Trend
function initSalesProfitTrendChart(data) {
  const options = {
    series: [{
      name: 'Sales',
      data: data.sales
    }, {
      name: 'Profit',
      data: data.profits
    }],
    chart: {
      type: 'area',
      height: 300,
      stacked: true,
      fontFamily: 'Arial, sans-serif',
      toolbar: {
        show: false
      }
    },
    dataLabels: {
      enabled: false
    },
    stroke: {
      curve: 'smooth',
      width: 2
    },
    fill: {
      type: 'gradient',
      gradient: {
        opacityFrom: 0.6,
        opacityTo: 0.2,
      }
    },
    // Markers configuration with size, fill colors, stroke colors, and stroke width
    markers: {
      size: 1,
      colors: ['#021640', '#0066CC'],
      strokeColors: ['#021640', '#0066CC'],
      strokeWidth: 1
    },
    legend: {
      position: 'top',
      horizontalAlign: 'right',
      fontSize: '12px',
      labels: {
        colors: '#021640'
      }
    },
    xaxis: {
      type: 'datetime', // treat categories as dates
      categories: data.dates, // ensure these are valid date strings or timestamps
      labels: {
        format: 'MMM-yy', // display dates in "MMM-YY" format
        style: {
          colors: '#021640',
          fontSize: '12px'
        }
      }
    },
        yaxis: {
          labels: {
            formatter: function(value) {
              return (value / 1000) + 'k';
            },
            style: {
              colors: '#021640',
              fontSize: '12px'
            }
          }
        },


    colors: ['#021640', '#0066CC'],
    grid: {
      borderColor: '#e0e0e0',
      strokeDashArray: 4
    }
  };
  
  const chart = new ApexCharts(document.querySelector("#salesProfitTrendChart"), options);
  chart.render();
}


  </script>
</body>
</html>


